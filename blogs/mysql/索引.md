---
title: Mysql中的索引
date: 2021-1-15
tags:
 - 数据库
---

## 数据库的索引是什么

    是数据库操作系统中一个排序的数据结构(k,v -- > 索引值,磁盘地址),以协助快速查询，更新数据库表中的数据。

## 索引的类型

    普通的索引(没有加任何的约束)

    唯一索引(索引值唯一,主键是特殊的唯一索引)

    全文索引

## 索引存储结构的推演

    有序数组，链表，二叉查找树(查找的效率与树的深度相关，在特定的情况下会蜕变成链表)。

    树的一个节点存放的是地址、改磁盘地址的数据和左右指针

    平衡二叉树（avl树）：左右子树的深度差绝对值不能超过1，通过旋转来保证平衡，每次访问一个节点就会发生磁盘I/O操作，每一个树的节点设计成16kb，一个节点存 放的内容太少，一次磁盘的I/O读取16kb，可能一个节点的数据只有10byte。

    B-Tree:多路平衡查找树：通过节点的分裂合并来保证平衡，

为什么主键id用自增的而不用uuid?

自增的话他会填满一页再到下一个磁盘页，如果用uuid会频繁的发生分裂合并操作，会产生大量的磁盘碎片。

B+Tree:非叶子节点只存磁盘地址不存数据，非叶子节点存放的磁盘地址更多,树的深度更低，只在叶子节点存放数据，叶子节点是双向指针。

B+Tree的优点：

​	1.b-Tree能解决的问题，B+树也能解决

​	2.扫库扫表的能力更强，只用遍历双向链表就能全局扫描

​	3.磁盘读写能力更强(I/O的次数更少)

​	4.排序、范围查找的能力更强

​	5.效率更加稳定

## 聚集索引和非聚集索引

    聚集索引(innodb)：索引的逻辑顺序与数据行的物理顺序一致。字典中拼音目录是聚集索引，偏旁目录不是聚集索引。如果有主键，就是聚集索引。

有主键

没有主键，又不为空的唯一索引

没有索引

## 索引的创建和使用

    列的离散度：选择离散度高字段建立索引，离散度低的字段(例如性别)在b+树创建索引的时候到底走左边还是右边不太清楚。

    联合索引的最左匹配原则：查询条件使用的字段必须从索引的最左边字段开始，不能跳过，不能中断。

    覆盖索引：select的字段已经包含在已经用到的索引中，不需要回表操作。看是否用到覆盖索引：extra user inding

## 在什么字段上创建索引

​	1.where jion order by

​	2.索引个数不要过度

​	3.散列度低的字段不需要索引

​	4.随机无序或频繁更新的字段不要创建索引

​	5.创建复合索引时避免冗余字段

## 什么时候索引会失效

    1.索引列上使用函数，运算符，表达式

    2.出现类型的隐式计算

    3.like字段前面用%（最左匹配原则啊）

    4.负向查询<> ! NOT IN

